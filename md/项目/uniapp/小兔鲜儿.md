## ä»‹ç»

> é¡¹ç›®æ–‡æ¡£åœ°å€ï¼š[å°å…”é²œå„¿å°ç¨‹åº | uniapp+vue3+ts](https://megasu.gitee.io/uni-app-shop-note/)
> é¡¹ç›®ä»£ç ä»“åº“åœ°å€ï¼š[å°å…”é²œå„¿-vue3+ts-uniapp-2023æ–°ç‰ˆ: å°å…”é²œå„¿-vue3+ts-uniapp é¡¹ç›®å·²ä¸Šçº¿ï¼Œå°ç¨‹åºæœç´¢ã€Šå°å…”é²œå„¿ã€‹å³å¯ä½“éªŒã€‚ğŸ‰ğŸ‰ğŸ‰ <br/> é…å¥—é¡¹ç›®æ¥å£æ–‡æ¡£ï¼Œé…å¥—ç¬”è®°ã€‚](https://gitee.com/Megasu/uniapp-shop-vue3-ts)

- æœ€æ–°æŠ€æœ¯æ ˆï¼šåŸºäº uni-app å¤šç«¯å¼€å‘æ¡†æ¶ï¼Œé‡‡ç”¨ Vue3 + TS + Pinia + UniUI çš„æœ€æ–°ç»„åˆå¼€å‘ï¼Œç¼–ç ç¬¦åˆ ESLint + Prettierrc + Git Hooks å›¢é˜Ÿè§„èŒƒã€‚
- æœ€ä½³çš„å®è·µï¼šVue3+TS ç»„åˆå¼ API æœ€ä½³å®è·µï¼Œå¼€å‘ä¸»æµå¾®ä¿¡å°ç¨‹åºç«¯å¹¶æ‰“åŒ…ä¸Šçº¿ï¼ŒåŒæ—¶å…¼å®¹ H5 ç«¯ï¼ŒApp ç«¯ã€‚
- æœ€å¤šçš„ä¸šåŠ¡ï¼šæ¶µç›–äº†çŒœä½ å–œæ¬¢ã€çƒ­é—¨æ¨èã€å•†å“åˆ†ç±»ã€å•†å“è¯¦æƒ…ã€å¾®ä¿¡ç™»å½•ã€ç”¨æˆ·ç®¡ç†ã€åœ°å€ç®¡ç†ã€è´­ç‰©è½¦ç®¡ç†ã€è®¢å•ç®¡ç†ç­‰åŠŸèƒ½ã€‚åŒ…å«å¾®ä¿¡ç™»å½•ï¼Œå¾®ä¿¡æ”¯ä»˜ç­‰ä¸šåŠ¡ã€‚

## é¡¹ç›®èµ·æ­¥

### èµ„æ–™è¯´æ˜

- ğŸ“€è§†é¢‘å­¦ä¹ ï¼š[é»‘é©¬ç¨‹åºå‘˜å‰ç«¯é¡¹ç›®uniappå°å…”é²œå„¿å¾®ä¿¡å°ç¨‹åºé¡¹ç›®è§†é¢‘æ•™ç¨‹ï¼ŒåŸºäºVue3+Ts+Pinia+uni-appçš„æœ€æ–°ç»„åˆæŠ€æœ¯æ ˆå¼€å‘çš„ç”µå•†ä¸šåŠ¡å…¨æµç¨‹\_å“”å“©å“”å“©\_bilibili](https://www.bilibili.com/video/BV1Bp4y1379L/)
- ğŸ“—æ¥å£æ–‡æ¡£ï¼š[apifox.com/apidoc/shared-0e6ee326-d646-41bd-9214-29dbf47648fa/](https://www.apifox.cn/apidoc/shared-0e6ee326-d646-41bd-9214-29dbf47648fa/)
- âœï¸åœ¨çº¿ç¬”è®°ï¼š[å°å…”é²œå„¿å°ç¨‹åº | uniapp+vue3+ts](https://megasu.gitee.io/uni-app-shop-note/)
- ğŸ“¦é¡¹ç›®æºç ï¼š[å°å…”é²œå„¿-vue3+ts-uniapp-2023æ–°ç‰ˆ: å°å…”é²œå„¿-vue3+ts-uniapp é¡¹ç›®å·²ä¸Šçº¿ï¼Œå°ç¨‹åºæœç´¢ã€Šå°å…”é²œå„¿ã€‹å³å¯ä½“éªŒã€‚ğŸ‰ğŸ‰ğŸ‰ <br/> é…å¥—é¡¹ç›®æ¥å£æ–‡æ¡£ï¼Œé…å¥—ç¬”è®°ã€‚](https://gitee.com/Megasu/uniapp-shop-vue3-ts/)

### æ‹‰å–é¡¹ç›®æ¨¡æ¿ä»£ç 

```bash
git clone -b template https://gitee.com/heima-fe/uniapp-shop-vue3-ts.git heima-shop
```

é¡¹ç›®æ¨¡æ¿åŒ…å«ï¼šç›®å½•ç»“æ„ï¼Œé¡¹ç›®ç´ æï¼Œä»£ç é£æ ¼ã€‚

> [!attention]
> å°ç¨‹åºçœŸæœºé¢„è§ˆéœ€åœ¨Â `manifest.json`Â ä¸­æ·»åŠ å¾®ä¿¡å°ç¨‹åºçš„Â `appid`

---

åŸºäº [uniapp+vue3+tsé¡¹ç›®æ¨¡æ¿æ­å»º](uniapp+vue3+tsé¡¹ç›®æ¨¡æ¿æ­å»º.md) åˆ›å»ºçš„é¡¹ç›®æ¨¡æ¿è¿›è¡Œå¼€å‘ï¼Œä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•ä¸€ä¸‹å’±ä»¬åˆ›å»ºçš„é¡¹ç›®æ¨¡æ¿æ˜¯å¦å¥½ç”¨ï¼Œå…¶å®ä¸¤è€…ä¹‹é—´ç›¸å·®ä¸å¤§ï¼Œåªä¸è¿‡å’±ä»¬åˆ›å»ºçš„é¡¹ç›®æ¨¡æ¿å¢åŠ äº†å…¶ä»–è¯¸å¦‚ commitlintã€commitizen ç­‰æ’ä»¶ï¼Œç„¶åæ‹‰å–ä¸‹æ¥çš„æ¨¡æ¿ä¸­åŒ…å«é¡¹ç›®ç´ æï¼Œå’±ä»¬æ‹·è´è¿‡æ¥å³å¯ã€‚

### uni-request è¯·æ±‚å°è£…

1. uniapp æ‹¦æˆªå™¨ï¼šÂ [uni.addInterceptor](https://uniapp.dcloud.net.cn/api/interceptor.html)
   1. æ‹¼æ¥åŸºç¡€åœ°å€
   2. è®¾ç½®è¶…æ—¶æ—¶é—´
   3. æ·»åŠ è¯·æ±‚å¤´æ ‡è¯†
   4. æ·»åŠ  token
2. å°è£… Promise è¯·æ±‚å‡½æ•°
  1. è¿”å› Promise å¯¹è±¡ï¼Œç”¨äºå¤„ç†è¿”å›å€¼ç±»å‹
  2. æˆåŠŸ resolve
      1. æå–æ•°æ®
      2. æ·»åŠ æ³›å‹
  3. å¤±è´¥ reject
      1. 401 é”™è¯¯
      2. å…¶ä»–é”™è¯¯
      3. ç½‘ç»œé”™è¯¯

å…·ä½“å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š

```typescript
import { useMemberStore } from '@/store/modules/member';

// è¯·æ±‚åŸºåœ°å€
const baseURL = 'https://pcapi-xiaotuxian-front-devtest.itheima.net';

// æ‹¦æˆªå™¨é…ç½®
const httpInterceptor = {
	// æ‹¦æˆªå‰è§¦å‘
	invoke(options: UniApp.RequestOptions) {
		// 1. é http å¼€å¤´éœ€æ‹¼æ¥åœ°å€
		if (!options.url.startsWith('http')) {
			options.url = baseURL + options.url;
		}
		// 2. è¯·æ±‚è¶…æ—¶
		options.timeout = 10000;
		// 3. æ·»åŠ å°ç¨‹åºç«¯è¯·æ±‚å¤´æ ‡è¯†
		options.header = {
			'source-client': 'miniapp',
			...options.header,
		};
		// 4. æ·»åŠ  token è¯·æ±‚å¤´æ ‡è¯†
		const memberStore = useMemberStore();
		const token = memberStore.profile?.token;
		if (token !== undefined) {
			options.header.Authorization = token;
		}
	},
};

// æ‹¦æˆª request è¯·æ±‚
uni.addInterceptor('request', httpInterceptor);
// æ‹¦æˆª uploadFile æ–‡ä»¶ä¸Šä¼ 
uni.addInterceptor('uploadFile', httpInterceptor);

/**
 * è¯·æ±‚å‡½æ•°
 * @param  UniApp.RequestOptions
 * @returns Promise
 *  1. è¿”å› Promise å¯¹è±¡
 *  2. è·å–æ•°æ®æˆåŠŸ
 *    2.1 æå–æ ¸å¿ƒæ•°æ® res.data
 *    2.2 æ·»åŠ ç±»å‹ï¼Œæ”¯æŒæ³›å‹
 *  3. è·å–æ•°æ®å¤±è´¥
 *    3.1 401é”™è¯¯  -> æ¸…ç†ç”¨æˆ·ä¿¡æ¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
 *    3.2 å…¶ä»–é”™è¯¯ -> æ ¹æ®åç«¯é”™è¯¯ä¿¡æ¯è½»æç¤º
 *    3.3 ç½‘ç»œé”™è¯¯ -> æç¤ºç”¨æˆ·æ¢ç½‘ç»œ
 */
interface Result<T> {
	code: string;
	msg: string;
	result: T;
}
// 2.2 æ·»åŠ ç±»å‹ï¼Œæ”¯æŒæ³›å‹
export const http = async <T>(options: UniApp.RequestOptions) => {
	// 1. è¿”å› Promise å¯¹è±¡
	return await new Promise<Result<T>>((resolve, reject) => {
		uni.request({
			...options,
			// å“åº”æˆåŠŸ
			success(res) {
				// çŠ¶æ€ç  2xxï¼Œ axios å°±æ˜¯è¿™æ ·è®¾è®¡çš„
				if (res.statusCode >= 200 && res.statusCode < 300) {
					// 2.1 æå–æ ¸å¿ƒæ•°æ® res.data
					resolve(res.data as Result<T>);
				} else if (res.statusCode === 401) {
					// 401é”™è¯¯  -> æ¸…ç†ç”¨æˆ·ä¿¡æ¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
					const memberStore = useMemberStore();
					memberStore.clearProfile();
					uni.navigateTo({ url: '/pages/login/login' });
					reject(res);
				} else {
					// å…¶ä»–é”™è¯¯ -> æ ¹æ®åç«¯é”™è¯¯ä¿¡æ¯è½»æç¤º
					uni.showToast({
						icon: 'none',
						title: (res.data as Result<T>).msg || 'è¯·æ±‚é”™è¯¯',
					});
					reject(res);
				}
			},
			// å“åº”å¤±è´¥
			fail(err) {
				uni.showToast({
					icon: 'none',
					title: 'ç½‘ç»œé”™è¯¯ï¼Œæ¢ä¸ªç½‘ç»œè¯•è¯•',
				});
				reject(err);
			},
		});
	});
};
```
