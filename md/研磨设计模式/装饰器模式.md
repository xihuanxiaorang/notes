# è£…é¥°å™¨æ¨¡å¼ (Decorator)

## ğŸ¨å®šä¹‰

**è£…é¥°å™¨æ¨¡å¼**æ˜¯ä¸€ç§<u><span style="background-color: rgb(232, 247, 207);">ç»“æ„å‹</span></u>è®¾è®¡æ¨¡å¼ï¼Œ å…è®¸ä½ é€šè¿‡å°†å¯¹è±¡æ”¾å…¥åŒ…å«è¡Œä¸ºçš„ç‰¹æ®Šå°è£…å¯¹è±¡ä¸­æ¥ä¸ºåŸå¯¹è±¡ç»‘å®šæ–°çš„è¡Œä¸ºã€‚

ç”±äº**ç›®æ ‡å¯¹è±¡å’Œè£…é¥°å™¨éµå¾ªåŒä¸€æ¥å£**ï¼Œå› æ­¤ä½ å¯ç”¨è£…é¥°å™¨æ¥å¯¹å¯¹è±¡è¿›è¡Œæ— é™æ¬¡çš„è£…é¥°ï¼Œ**ç»“æœå¯¹è±¡å°†è·å¾—æ‰€æœ‰è£…é¥°å™¨å åŠ è€Œæ¥çš„è¡Œä¸º**ã€‚

## ğŸ™é—®é¢˜

å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæä¾›é€šçŸ¥åŠŸèƒ½çš„åº“ï¼Œå…¶ä»–ç¨‹åºå¯ä½¿ç”¨å®ƒå‘ç”¨æˆ·å‘é€å…³äºé‡è¦äº‹ä»¶çš„é€šçŸ¥ã€‚

åº“çš„æœ€åˆç‰ˆæœ¬åŸºäºé€šçŸ¥å™¨ `Notifier` ç±»ï¼Œå…¶ä¸­åªæœ‰å¾ˆå°‘çš„å‡ ä¸ªæˆå‘˜å˜é‡ï¼Œä¸€ä¸ªæ„é€ å‡½æ•°å’Œä¸€ä¸ªæ ¸å¿ƒçš„ `send()` å‘é€æ–¹æ³•ã€‚è¯¥æ–¹æ³•å¯ä»¥æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯å‚æ•°ï¼Œå¹¶å°†è¯¥æ¶ˆæ¯å‘é€ç»™ä¸€ç³»åˆ—çš„é‚®ç®±ï¼Œ é‚®ç®±åˆ—è¡¨åˆ™æ˜¯é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’ç»™é€šçŸ¥å™¨çš„ã€‚ä½œä¸ºå®¢æˆ·ç«¯çš„ç¬¬ä¸‰æ–¹ç¨‹åºä»…ä¼šåˆ›å»ºå’Œé…ç½®é€šçŸ¥å™¨å¯¹è±¡ä¸€æ¬¡ï¼Œç„¶ååœ¨æœ‰é‡è¦äº‹ä»¶å‘ç”Ÿæ—¶å¯¹å…¶è¿›è¡Œè°ƒç”¨ã€‚

```plantuml
@startuml

class Notifier {
	+ send(message: String): void
}

class Application {
	- notifier: Notifier
	+ setNotifier(notifier: Notifier): void
	+ doSomething(): void
}

Application --> Notifier

note left of Application::doSomething
notifier.send("Alert!");
end note

@enduml
```

æ­¤åæŸä¸ªæ—¶åˆ»ï¼Œä½ ä¼šå‘ç°åº“çš„ç”¨æˆ·å¸Œæœ›ä½¿ç”¨é™¤é‚®ä»¶é€šçŸ¥ä¹‹å¤–çš„åŠŸèƒ½ã€‚è®¸å¤šç”¨æˆ·ä¼šå¸Œæœ›æ¥æ”¶å…³äºç´§æ€¥äº‹ä»¶çš„æ‰‹æœºçŸ­ä¿¡ï¼Œè¿˜æœ‰äº›ç”¨æˆ·å¸Œæœ›åœ¨å¾®ä¿¡ä¸Šæ¥æ”¶æ¶ˆæ¯ï¼Œè€Œå…¬å¸ç”¨æˆ·åˆ™å¸Œæœ›åœ¨ QQ ä¸Šæ¥æ”¶æ¶ˆæ¯ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼šå°†æ¯ç§é€šçŸ¥ç±»å‹ä½œä¸ºé€šçŸ¥å™¨çš„å­ç±»å¾—ä»¥å®ç°ã€‚

```plantuml
@startuml

class Notifier {}

class SMSNotifier extends Notifier {}

class WeChatNotifier extends Notifier {}

class QQNotifier extends Notifier {}

@enduml
```

è¿™æœ‰ä»€ä¹ˆéš¾çš„å‘¢ï¼Ÿé¦–å…ˆæ‰©å±•é€šçŸ¥å™¨ç±»ï¼Œç„¶ååœ¨æ–°çš„å­ç±»ä¸­åŠ å…¥é¢å¤–çš„é€šçŸ¥æ–¹æ³•ã€‚ç°åœ¨å®¢æˆ·ç«¯è¦å¯¹æ‰€éœ€é€šçŸ¥å½¢å¼çš„å¯¹åº”ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åä½¿ç”¨è¯¥ç±»å‘é€åç»­æ‰€æœ‰çš„é€šçŸ¥æ¶ˆæ¯ã€‚

ä½†æ˜¯å¾ˆå¿«æœ‰äººä¼šé—®ï¼š" ä¸ºä»€ä¹ˆä¸**åŒæ—¶ä½¿ç”¨å¤šç§é€šçŸ¥å½¢å¼**å‘¢ï¼Ÿå¦‚æœæˆ¿å­ç€ç«äº†ï¼Œä½ å¤§æ¦‚ä¼šæƒ³åœ¨æ‰€æœ‰æ¸ é“ä¸­éƒ½æ”¶åˆ°ç›¸åŒçš„æ¶ˆæ¯å§ã€‚"

ä½ å¯ä»¥å°è¯•åˆ›å»ºä¸€ä¸ªç‰¹æ®Šå­ç±»æ¥å°†å¤šç§é€šçŸ¥æ–¹æ³•ç»„åˆåœ¨ä¸€èµ·ä»¥è§£å†³è¯¥é—®é¢˜ã€‚ä½†è¿™ç§æ–¹å¼ä¼šä½¿å¾—ä»£ç é‡è¿…é€Ÿè†¨èƒ€ï¼Œä¸ä»…ä»…æ˜¯ç¨‹åºåº“ä»£ç ï¼Œå®¢æˆ·ç«¯ä»£ç ä¹Ÿä¼šå¦‚æ­¤ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼šå­ç±»ç»„åˆæ•°é‡æˆçˆ†ç‚¸å¼å¢é•¿ã€‚

```plantuml
@startuml

class Notifier {}

class SMSNotifier extends Notifier {}

class WeChatNotifier extends Notifier {}

class QQNotifier extends Notifier {}

class SMS_WeChatNotifier extends Notifier {}

class SMS_QQNotifier extends Notifier {}

class WeChat_QQNotifier extends Notifier {}

class SMS_WeChat_QQNotifier extends Notifier {}

@enduml
```

å› æ­¤å¿…é¡»æ‰¾åˆ°å…¶ä»–æ–¹æ³•æ¥è§„åˆ’é€šçŸ¥ç±»çš„ç»“æ„ï¼Œå¦åˆ™å®ƒä»¬çš„æ•°é‡å°†ä¼šåœ¨ä¸ç»æ„ä¹‹é—´æ‰“ç ´å‰å°¼æ–¯çºªå½•ï¼

## ğŸ¥³è§£å†³æ–¹æ¡ˆ

å½“ä½ éœ€è¦**æ›´æ”¹ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸º**æ—¶ï¼Œç¬¬ä¸€ä¸ªè·³å…¥è„‘æµ·çš„æƒ³æ³•å°±æ˜¯æ‰©å±•å®ƒæ‰€å±çš„ç±»ã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½å¿½è§†**ç»§æ‰¿**å¯èƒ½å¼•å‘çš„å‡ ä¸ªä¸¥é‡é—®é¢˜ã€‚

- ç»§æ‰¿æ˜¯é™æ€çš„ã€‚ä½ æ— æ³•åœ¨è¿è¡Œæ—¶æ›´æ”¹å·²æœ‰å¯¹è±¡çš„è¡Œä¸ºï¼Œåªèƒ½ä½¿ç”¨ç”±ä¸åŒå­ç±»åˆ›å»ºçš„å¯¹è±¡æ¥æ›¿ä»£å½“å‰çš„æ•´ä¸ªå¯¹è±¡ï¼›
- å­ç±»åªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»ã€‚åœ¨ Java ä¸å…è®¸ä¸€ä¸ªç±»åŒæ—¶ç»§æ‰¿å¤šä¸ªç±»çš„è¡Œä¸ºï¼Œå±äº**å•ç»§æ‰¿**ï¼›

å¦å¤–ä¸€ç§æ–¹æ³•åˆ™æ˜¯ä½¿ç”¨**ç»„åˆï¼ˆä¸€ä¸ªå¯¹è±¡æŒæœ‰å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶å°†éƒ¨åˆ†å·¥ä½œå§”æ´¾ç»™å¼•ç”¨å¯¹è±¡ï¼‰**çš„æ–¹å¼å®ç°ï¼Œç»„åˆçš„æ–¹å¼æ˜¯è®¸å¤šè®¾è®¡æ¨¡å¼èƒŒåçš„å…³é”®åŸåˆ™ï¼ˆåŒ…æ‹¬è£…é¥°å™¨æ¨¡å¼åœ¨å†…ï¼‰ã€‚

åœ¨è£…é¥°å™¨æ¨¡å¼ä¸­ï¼Œ**è£…é¥°å™¨**æ˜¯ä¸€ä¸ªèƒ½ä¸å…¶ä»–**ç›®æ ‡å¯¹è±¡**è¿æ¥çš„å¯¹è±¡ï¼Œ**è£…é¥°å™¨åŒ…å«ä¸ç›®æ ‡å¯¹è±¡ç›¸åŒçš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œå³é€šè¿‡å®ç°ä¸ç›®æ ‡å¯¹è±¡ç›¸åŒçš„æ¥å£ï¼Œå®ƒä¼šå°†æ‰€æœ‰æ¥æ”¶åˆ°çš„è¯·æ±‚å§”æ´¾ç»™ç›®æ ‡å¯¹è±¡ï¼Œåªä¸è¿‡è£…é¥°å™¨å¯ä»¥åœ¨å°†è¯·æ±‚å§”æ´¾ç»™ç›®æ ‡å¯¹è±¡å‰åå¯¹å…¶è¿›è¡Œå¤„ç†**ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæ”¹å˜æœ€ç»ˆç»“æœã€‚

å› æ­¤ä»å®¢æˆ·ç«¯çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›å¯¹è±¡ï¼ˆä¸ç®¡æ˜¯ç›®æ ‡å¯¹è±¡è¿˜æ˜¯è£…é¥°å™¨å¯¹è±¡ï¼‰æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚è£…é¥°å™¨ä¸­çš„æˆå‘˜å˜é‡å¼•ç”¨å¯ä»¥æ˜¯éµå¾ªç›¸åŒæ¥å£çš„ä»»æ„å¯¹è±¡ â¡ï¸ å› æ­¤ä½ å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡æ”¾å…¥åˆ°å¤šä¸ªè£…é¥°å™¨ä¸­ â¡ï¸ è¯¥å¯¹è±¡å°†å…·å¤‡æ‰€æœ‰è¿™äº›è£…é¥°å™¨çš„ç»„åˆè¡Œä¸ºã€‚

æ¯”å¦‚åœ¨ä¸Šé¢æ¶ˆæ¯é€šçŸ¥çš„ç¤ºä¾‹ä¸­ï¼Œå’±ä»¬å°±å¯ä»¥å°†ç®€å•é‚®ä»¶é€šçŸ¥è¡Œä¸ºæ”¾åœ¨åŸºç±» `Notifier` ä¸­ï¼Œä½†æ˜¯å°†å…¶ä»–çš„é€šçŸ¥æ–¹æ³•æ”¾å…¥å¯¹åº”ä¸åŒçš„è£…é¥°å™¨ï¼ˆå¦‚ `SMSDecorator`ã€`WeChatDecorator`ã€`QQDecorator`ï¼‰ä¸­ã€‚

```plantuml
@startuml

class Notifier {
	+ send(message: String): void
}

class BaseDecorator extends Notifier {
	- wrappee: Notifier
	+ BaseDecorator(notifier: Notifier)
	+ send(message: String)
}

class SMSDecorator extends BaseDecorator {
	+ send(message: String)
}

class WeChatDecorator extends BaseDecorator {
	+ send(message: String)
}

class QQDecorator extends BaseDecorator {
	+ send(message: String)
}

BaseDecorator o-up-> Notifier

note left of BaseDecorator::send
wrappee.send(message);
end note

note right of SMSDecorator::send
super.send(message);
sendSMS(message);
end note

@enduml
```

å®¢æˆ·ç«¯ä»£ç å¿…é¡»å°†åŸºç¡€é€šçŸ¥å™¨æ”¾å…¥ä¸€ç³»åˆ—è‡ªå·±æ‰€éœ€çš„è£…é¥°å™¨ä¸­ï¼Œå› æ­¤æœ€åçš„å¯¹è±¡å°†å½¢æˆä¸€ä¸ª<u>**æ ˆï¼ˆå…ˆè¿›åå‡ºï¼‰**</u>ç»“æ„ã€‚

```plantuml
@startuml

class Application {
	- notifier: Notifier
	+ setNotifier(notifier: Notifier): void
	+ doSomething(): void
}

note top of Application
Notifier notifier = new Notifier();
if(weChatEnabled) 
	notifier = new WeChatDecorator(notifier);
if(qqEnabled)
	notifier = new QQDecorator(notifier);
app.setNotifier(notifier);
end note

note left of Application::doSomething
notifier.send("Alert!");
// Email -> WeChat -> QQ
end note

@enduml
```

**å®é™…ä¸å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’çš„å¯¹è±¡æ˜¯æœ€åä¸€ä¸ªè¿›å…¥æ ˆä¸­çš„è£…é¥°å™¨å¯¹è±¡**ã€‚ç”±äºæ‰€æœ‰çš„è£…é¥°å™¨éƒ½å®ç°äº†ä¸é€šçŸ¥åŸºç±»ç›¸åŒçš„æ¥å£ï¼Œå®¢æˆ·ç«¯çš„å…¶ä»–ä»£ç å¹¶ä¸åœ¨æ„è‡ªå·±åˆ°åº•æ˜¯ä¸ " çº¯ç²¹ " çš„é€šçŸ¥å™¨å¯¹è±¡ï¼Œè¿˜æ˜¯ä¸è£…é¥°åçš„é€šçŸ¥å™¨å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚ä¸¾ä¸€åä¸‰ï¼Œå’±ä»¬å¯ä»¥ä½¿ç”¨ç›¸åŒæ–¹æ³•æ¥å®ç°å…¶ä»–çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œè®¾ç½®æ¶ˆæ¯æ ¼å¼å’Œåˆ›å»ºæ¥æ”¶äººåˆ—è¡¨ï¼‰ã€‚åªè¦æ‰€æœ‰è£…é¥°å™¨éƒ½éµå¾ªç›¸åŒçš„æ¥å£ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥ä½¿ç”¨ä»»æ„è‡ªå®šä¹‰çš„è£…é¥°å™¨æ¥è£…é¥°å¯¹è±¡ã€‚

## ğŸš—çœŸå®ä¸–ç•Œç±»æ¯”

![è£…é¥°æ¨¡å¼ç¤ºä¾‹](https://fastly.jsdelivr.net/gh/xihuanxiaorang/img/202310160122078.png)

ç©¿è¡£æœæ˜¯ä½¿ç”¨è£…é¥°çš„ä¸€ä¸ªå…¸å‹ä¾‹å­ã€‚å½“ä½ è§‰å¾—å†·æ—¶ï¼Œä½ å¯ä»¥ç©¿ä¸€ä»¶æ¯›è¡£ã€‚å¦‚æœä½ ç©¿äº†æ¯›è¡£è¿˜è§‰å¾—å†·ï¼Œä½ å¯ä»¥å†å¥—ä¸Šä¸€ä»¶å¤¹å…‹ã€‚å¦‚æœé‡åˆ°ä¸‹é›¨ï¼Œä½ è¿˜å¯ä»¥å†ç©¿ä¸Šä¸€ä»¶é›¨è¡£ã€‚**æ‰€æœ‰è¿™äº›è¡£ç‰©éƒ½ " æ‰©å±• " äº†ä½ çš„åŸºæœ¬è¡Œä¸ºï¼Œä½†å®ƒä»¬å¹¶ä¸æ˜¯ä½ çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœä½ ä¸å†éœ€è¦æŸä»¶è¡£ç‰©ï¼Œå¯ä»¥ååˆ†æ–¹ä¾¿åœ°éšæ—¶è„±æ‰**ã€‚

## ğŸ¯ç»“æ„

```plantuml
@startuml

class Client {
  + {static} main(args: String[]): void
}

interface Component <<interface>> {
	+ execute(): void
}

class ConcreteComponent implements Component {
	+ execute(): void
}

class BaseDecorator implements Component {
	- wrappee: Component
	+ BaseDecorator(c: Component)
	+ execute(): void
}

class ConcreteDecoratorA extends BaseDecorator {
		+ execute(): void
		+ extra(): void
}

class ConcreteDecoratorB extends BaseDecorator {
		+ execute(): void
		+ extra(): void
}

Client  ..> Component
BaseDecorator o--> Component

note right of Client::main
Component a = new ConcreteComponent();
Component b = new ConcreteDecoratorA(a);
Component c = new ConcreteDecoratorB(b);
c.execute();
// DecoratorB -> DecoratorA -> ConcreteComponent
end note

note left of BaseDecorator::BaseDecorator
wrappee = c;
end note

note right of BaseDecorator::execute
wrappee.execute();
end note

note right of ConcreteDecoratorA::execute
super.execute();
extra();
end note

@enduml
```

- éƒ¨ä»¶ï¼ˆComponentï¼‰ï¼šæ˜¯æ‰€æœ‰è£…é¥°å™¨å’Œç›®æ ‡å¯¹è±¡ï¼ˆå³è¢«è£…é¥°å¯¹è±¡ï¼‰éƒ½éœ€è¦å®ç°çš„æ¥å£ï¼Œæ˜¯æ•´ä¸ªåŠŸèƒ½çš„æ ¸å¿ƒæŠ½è±¡ã€‚
- å…·ä½“éƒ¨ä»¶ï¼ˆConcreteComponentï¼‰ï¼šå…·ä½“çš„ç»„ä»¶å¯¹è±¡ï¼Œé€šå¸¸å°±æ˜¯ç”¨æ¥è¢«è£…é¥°å™¨è¿›è¡Œè£…é¥°çš„ç›®æ ‡å¯¹è±¡ï¼Œå®ƒå®ç°äº† Component æ¥å£æœ€åŸºç¡€ã€æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚
- **åŸºç¡€è£…é¥°å™¨**ï¼ˆBaseDecoratorï¼‰ï¼šæ˜¯æ‰€æœ‰è£…é¥°å™¨çš„æŠ½è±¡çˆ¶ç±»ï¼Œä¸ç›®æ ‡å¯¹è±¡å®ç°ç›¸åŒçš„ Component æ¥å£ï¼Œåœ¨è¯¥ç±»ä¸­æŒæœ‰ä¸€ä¸ª Component æ¥å£ç±»å‹çš„å¼•ç”¨ï¼Œå®ƒä¼šå°†æ‰€æœ‰æ¥æ”¶åˆ°çš„è¯·æ±‚å§”æ´¾ç»™å¼•ç”¨å¯¹è±¡ï¼Œè¯¥å¼•ç”¨å¯¹è±¡å¯ä»¥æ˜¯å…·ä½“çš„éƒ¨ä»¶æˆ–è€…è£…é¥°å™¨ï¼Œè¿™æ ·è®¾è®¡çš„è¯ï¼Œæœ€ç»ˆçš„ç»“æœå¯¹è±¡å°†å…·å¤‡æ‰€æœ‰è£…é¥°å™¨ä»¥åŠç›®æ ‡å¯¹è±¡çš„ç»„åˆè¡Œä¸ºã€‚
- å…·ä½“è£…é¥°å™¨ï¼ˆConcreteDecoratorï¼‰ï¼šå®šä¹‰äº†å¯åŠ¨æ€æ·»åŠ åˆ°éƒ¨ä»¶çš„é¢å¤–è¡Œä¸ºï¼Œå®ƒä¼šé‡å†™çˆ¶ç±»ï¼ˆåŸºç¡€è£…é¥°å™¨ï¼‰ä¸­çš„æ–¹æ³•ï¼Œå¹¶åœ¨è°ƒç”¨çˆ¶ç±»æ–¹æ³•çš„å‰åæ‰§è¡Œé¢å¤–çš„è¡Œä¸ºã€‚

## ğŸš€ä»£ç ç¤ºä¾‹

[Java è£…é¥°æ¨¡å¼è®²è§£å’Œä»£ç ç¤ºä¾‹](https://refactoringguru.cn/design-patterns/decorator/java/example#example-0) æœ¬æ¡ˆä¾‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼åœ¨ä¸æ”¹å˜åŸæœ‰æ•°æ®è¯»å†™å™¨ä»£ç çš„å‰æä¸‹ï¼Œç»™å…¶å¢åŠ åŠ è§£å¯†å’Œè§£å‹ç¼©çš„åŠŸèƒ½ã€‚

æœ€åˆçš„ä¸šåŠ¡é€»è¾‘ç±»ä»…èƒ½è¯»å–å’Œå†™å…¥çº¯æ–‡æœ¬çš„æ•°æ®ã€‚æ­¤åï¼Œå’±ä»¬éœ€è¦åˆ›å»ºä¸¤ä¸ªè£…é¥°å™¨ï¼Œä»¥ä¾¿åœ¨æ‰§è¡Œæ ‡å‡†æ“ä½œåæ·»åŠ æ–°çš„è¡Œä¸ºã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªè£…é¥°å™¨è´Ÿè´£åŠ å¯†å’Œè§£å¯†æ•°æ®ï¼Œè€Œç¬¬äºŒä¸ªè£…é¥°å™¨åˆ™è´Ÿè´£å‹ç¼©å’Œè§£å‹æ•°æ®ï¼Œç”šè‡³å¯ä»¥è®©è¿™ä¸¤ä¸ªè£…é¥°å™¨è¿›è¡ŒåµŒå¥—ä»¥å°†å®ƒä»¬ç»„åˆèµ·æ¥ã€‚

### é€šç”¨æ•°æ®è¯»å†™æ¥å£

```java
public interface DataSource {
    void writeData(String data);

    String readData();
}
```

### ç®€å•æ•°æ®è¯»å†™å™¨

```java
public class FileDataSource implements DataSource {
    private final String fileName;

    public FileDataSource(String fileName) {
        this.fileName = fileName;
    }

    @Override
    public void writeData(String data) {
        try (FileOutputStream fos = new FileOutputStream(fileName)) {
            fos.write(data.getBytes(), 0, data.length());
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

    @Override
    public String readData() {
        try (FileInputStream fis = new FileInputStream(fileName)) {
            byte[] bytes = new byte[fis.available()];
            fis.read(bytes);
            return new String(bytes);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}
```

### åŸºç¡€è£…é¥°

```java
public class DataSourceDecorator implements DataSource {
    private final DataSource dataSource;

    public DataSourceDecorator(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    @Override
    public void writeData(String data) {
        dataSource.writeData(data);
    }

    @Override
    public String readData() {
        return dataSource.readData();
    }
}
```

### åŠ å¯†è£…é¥°å™¨

```java
public class EncryptionDecorator extends DataSourceDecorator {
    public EncryptionDecorator(DataSource dataSource) {
        super(dataSource);
    }

    @Override
    public void writeData(String data) {
        super.writeData(encode(data));
    }

    @Override
    public String readData() {
        return decode(super.readData());
    }

    private String encode(String data) {
        byte[] results = data.getBytes();
        for (int i = 0; i < results.length; i++) {
            results[i] += (byte) 1;
        }
        return Base64.getEncoder().encodeToString(results);
    }

    private String decode(String data) {
        byte[] results = Base64.getDecoder().decode(data);
        for (int i = 0; i < results.length; i++) {
            results[i] -= (byte) 1;
        }
        return new String(results);
    }
}
```

### å‹ç¼©è£…é¥°å™¨

```java
public class CompressionDecorator extends DataSourceDecorator {
    private int compressionLevel = 6;

    public CompressionDecorator(DataSource dataSource) {
        super(dataSource);
    }

    @Override
    public void writeData(String data) {
        super.writeData(compress(data));
    }

    @Override
    public String readData() {
        return decompress(super.readData());
    }

    private String compress(String stringData) {
        byte[] data = stringData.getBytes();
        try (ByteArrayOutputStream bout = new ByteArrayOutputStream(512)) {
            // æ­¤å¤„éœ€è¦å…ˆå…³é—­dosï¼Œå› ä¸ºdosæ˜¯ç¼“å†²çš„ï¼Œéœ€è¦å…ˆå…³é—­æ‰ä¼šå°†æ•°æ®å†™å…¥åˆ°boutä¸­
            // å¦åˆ™çš„è¯ä¼šå› ä¸ºæ•°æ®ä¸å®Œæ•´å¯¼è‡´è§£å‹å¤±è´¥ï¼ŒæŠ›å‡º EOFException: Unexpected end of ZLIB input stream å¼‚å¸¸
            try (DeflaterOutputStream dos = new DeflaterOutputStream(bout, new Deflater(compressionLevel))) {
                dos.write(data);
            }
            return Base64.getEncoder().encodeToString(bout.toByteArray());
        } catch (IOException ex) {
            throw new RuntimeException(ex);
        }
    }

    private String decompress(String stringData) {
        byte[] data = Base64.getDecoder().decode(stringData);
        try (InputStream in = new ByteArrayInputStream(data);
             InflaterInputStream iin = new InflaterInputStream(in);
             ByteArrayOutputStream bout = new ByteArrayOutputStream(512)) {
            int b;
            while ((b = iin.read()) != -1) {
                bout.write(b);
            }
            return bout.toString();
        } catch (IOException ex) {
            throw new RuntimeException(ex);
        }
    }

    public int getCompressionLevel() {
        return compressionLevel;
    }

    public void setCompressionLevel(int compressionLevel) {
        this.compressionLevel = compressionLevel;
    }
}
```

### æµ‹è¯•ç±»

```java
class ApiTest {
    private static final Logger logger = LoggerFactory.getLogger(ApiTest.class);

    @Test
    public void test() {
        String salaryRecords = "Name,Salary\nJohn Smith,100000\nSteven Jobs,912000";
        DataSource plain = new FileDataSource("target/test.txt");
        DataSourceDecorator encoded = new CompressionDecorator(
                new EncryptionDecorator(plain));
        encoded.writeData(salaryRecords);
        logger.info("- Input ----------------");
        logger.info(salaryRecords);
        logger.info("- Encoded --------------");
        logger.info(plain.readData());
        logger.info("- Decoded --------------");
        logger.info(encoded.readData());
    }
}
```

æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
[main] INFO  fun.xiaorang.designpattern.decorator.ApiTest - - Input ----------------
[main] INFO  fun.xiaorang.designpattern.decorator.ApiTest - Name,Salary
John Smith,100000
Steven Jobs,912000
[main] INFO  fun.xiaorang.designpattern.decorator.ApiTest - - Encoded --------------
[main] INFO  fun.xiaorang.designpattern.decorator.ApiTest - Zkt7e1Q5eU8yUm1Qe0ZsdHJ2VXp6dDBKVnhrUHtUe0sxRUYxQkJIdjVLTVZ0dVI5Q2IwOXFISmVUMU5rcENCQmdxRlByaD4+
[main] INFO  fun.xiaorang.designpattern.decorator.ApiTest - - Decoded --------------
[main] INFO  fun.xiaorang.designpattern.decorator.ApiTest - Name,Salary
John Smith,100000
Steven Jobs,912000
```

## ğŸ‰åº”ç”¨åœºæ™¯

ğŸ **å¦‚æœä½ å¸Œæœ›åœ¨æ— éœ€ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹å³å¯ä½¿ç”¨å¯¹è±¡ï¼Œä¸”å¸Œæœ›åœ¨è¿è¡Œæ—¶ä¸ºå¯¹è±¡æ–°å¢é¢å¤–çš„è¡Œä¸ºï¼Œå¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼**ã€‚

âš¡ è£…é¥°èƒ½å°†ä¸šåŠ¡é€»è¾‘ç»„ç»‡ä¸ºå±‚æ¬¡ç»“æ„ï¼Œä½ å¯ä¸ºå„å±‚åˆ›å»ºä¸€ä¸ªè£…é¥°ï¼Œåœ¨è¿è¡Œæ—¶å°†å„ç§ä¸åŒé€»è¾‘ç»„åˆæˆå¯¹è±¡ã€‚ç”±äºè¿™äº›å¯¹è±¡éƒ½éµå¾ªé€šç”¨æ¥å£ï¼Œå®¢æˆ·ç«¯ä»£ç èƒ½ä»¥ç›¸åŒçš„æ–¹å¼ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚

---

ğŸ **å¦‚æœç”¨ç»§æ‰¿æ¥æ‰©å±•å¯¹è±¡è¡Œä¸ºçš„æ–¹æ¡ˆéš¾ä»¥å®ç°æˆ–è€…æ ¹æœ¬ä¸å¯è¡Œï¼Œä½ å¯ä»¥ä½¿ç”¨è¯¥æ¨¡å¼**ã€‚

âš¡ åœ¨ Java ä¸­ä¼šä½¿ç”¨ `final` å…³é”®å­—æ¥é™åˆ¶å¯¹æŸä¸ªç±»çš„è¿›ä¸€æ­¥æ‰©å±•ï¼Œè€Œå¤ç”¨æœ€ç»ˆç±»å·²æœ‰è¡Œä¸ºçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼šä½¿ç”¨è£…é¥°å™¨å¯¹å…¶è¿›è¡Œè£…é¥°ã€‚

## ğŸ“å®ç°æ–¹å¼

1. ç¡®ä¿ä¸šåŠ¡é€»è¾‘å¯ç”¨ä¸€ä¸ªåŸºæœ¬ç»„ä»¶åŠå¤šä¸ªé¢å¤–å¯é€‰å±‚æ¬¡è¡¨ç¤ºï¼›
2. æ‰¾å‡ºåŸºæœ¬ç»„ä»¶å’Œå¯é€‰å±‚æ¬¡çš„é€šç”¨æ–¹æ³•ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª**ç»„ä»¶ï¼ˆComponentï¼‰æ¥å£**å¹¶åœ¨å…¶ä¸­å£°æ˜è¿™äº›æ–¹æ³•ï¼›
3. åˆ›å»ºä¸€ä¸ª**å…·ä½“ç»„ä»¶ï¼ˆConcreteComponentï¼‰**ç±»ï¼Œå¹¶å®šä¹‰å…¶åŸºç¡€è¡Œä¸ºï¼›
4. åˆ›å»º**åŸºç¡€è£…é¥°å™¨ï¼ˆBaseDecoratorï¼‰**ç±»ï¼Œä½¿ç”¨ä¸€ä¸ªæˆå‘˜å˜é‡å­˜å‚¨æŒ‡å‘è¢«è£…é¥°å¯¹è±¡çš„å¼•ç”¨ï¼Œè¯¥æˆå‘˜å˜é‡å¿…é¡»è¢«å£°æ˜ä¸º**ç»„ä»¶ï¼ˆComponentï¼‰æ¥å£**ç±»å‹ï¼Œä»è€Œèƒ½åœ¨è¿è¡Œæ—¶è¿æ¥å…·ä½“ç»„ä»¶å’Œè£…é¥°ã€‚åŸºç¡€è£…é¥°å™¨å¿…é¡»å°†æ‰€æœ‰å·¥ä½œå§”æ´¾ç»™è¢«å°è£…çš„å¯¹è±¡ã€‚
5. ç¡®ä¿æ‰€æœ‰ç±»å®ç°ç»„ä»¶æ¥å£ï¼›
6. å°†åŸºç¡€è£…é¥°å™¨æ‰©å±•ä¸º**å…·ä½“è£…é¥°å™¨ï¼ˆConcreteDecoratorï¼‰**ï¼Œå…·ä½“è£…é¥°å™¨å¿…é¡»åœ¨è°ƒç”¨çˆ¶ç±»æ–¹æ³• ï¼ˆæ€»æ˜¯å§”æ´¾ç»™è¢«å°è£…å¯¹è±¡ï¼‰ çš„å‰åæ‰§è¡Œè‡ªèº«çš„è¡Œä¸ºã€‚
7. å®¢æˆ·ç«¯ä»£ç è´Ÿè´£åˆ›å»ºè£…é¥°å™¨ä»¥åŠç›®æ ‡å¯¹è±¡å¹¶å°†å…¶ç»„åˆæˆå®¢æˆ·ç«¯æ‰€éœ€çš„å½¢å¼ã€‚

## âš–ï¸ä¼˜ç¼ºç‚¹

- âœ”ï¸ æ— éœ€åˆ›å»ºæ–°å­ç±»å³å¯æ‰©å±•å¯¹è±¡çš„è¡Œä¸ºï¼›
- âœ”ï¸ å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ æˆ–åˆ é™¤å¯¹è±¡çš„åŠŸèƒ½ï¼›
- âœ”ï¸ å¯ä»¥ç”¨å¤šä¸ªè£…é¥°å™¨æ¥è£…é¥°å¯¹è±¡ä»è€Œç»„åˆå¤šç§è¡Œä¸ºï¼›
- âœ”ï¸ **å•ä¸€èŒè´£åŸåˆ™**ã€‚å¯ä»¥å°†å®ç°äº†è®¸å¤šä¸åŒè¡Œä¸ºçš„ä¸€ä¸ªå¤§ç±»æ‹†åˆ†ä¸ºå¤šä¸ªè¾ƒå°çš„ç±»ï¼›
- âŒ åœ¨å°è£…å™¨æ ˆä¸­åˆ é™¤ç‰¹å®šå°è£…å™¨æ¯”è¾ƒå›°éš¾ï¼›
- âŒ å®ç°è¡Œä¸ºä¸å—è£…é¥°æ ˆé¡ºåºå½±å“çš„è£…é¥°æ¯”è¾ƒå›°éš¾ï¼›
- âŒ å„å±‚çš„åˆå§‹åŒ–é…ç½®ä»£ç çœ‹ä¸Šå»å¯èƒ½ä¼šå¾ˆç³Ÿç³•ï¼›
